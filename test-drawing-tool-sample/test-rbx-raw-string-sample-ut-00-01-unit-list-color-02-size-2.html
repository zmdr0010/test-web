<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test rbx raw string sample ut-00 01 unit list color 02 size 2</title>

  <style>
    canvas {
      /*width: 100%;*/
      /*height: 100%;*/
      border: 1px solid #000000;
      background-color: beige;
    }
  </style>
</head>
<body onload="init()">
  <div id="id-display-size">canvas</div>
  <canvas id="id-canvas"></canvas>

  <script type="application/javascript" src="rbx-raw-string-sample-ut-00.js"></script>
  <script>
    // 582f0e // 88,47,14
    // 7f4f24 // 127,79,36
    // 936639 // 147,102,57
    // a68a64 // 166,138,100
    // b6ad90 // 182,173,144
    // c2c5aa // 194,197,170
    // a4ac86 // 164,172,134
    // 656d4a // 101,109,74
    // 414833 // 65,72,51
    // 333d29 // 51,61,29

    // 000814 // 0,8,20
    // 001d3d // 0,29,61
    // 003566 // 0,53,102
    // ffc300 // 255,195,0
    // ffd60a // 255,214,10

    // ff99c8 // 255,153,200
    // fcf6bd // 252,246,189
    // d0f4de // 208,244,222
    // a9def9 // 169,222,249
    // e4c1f9 // 228,193,249

    // 001524 // 0,21,36
    // 15616d // 21,97,109
    // ffecd1 // 255,236,209
    // ff7d00 // 255,125,0
    // 78290f // 120,41,15

    // 2b2d42 // 43,45,66
    // 8d99ae // 141,153,174
    // edf2f4 // 237,242,244
    // ef233c // 239,35,60
    // d90429 // 217,4,41

    // ff595e // 255,89,94
    // ffca3a // 255,202,58
    // 8ac926 // 138,201,38
    // 1982c4 // 25,130,196
    // 6a4c93 // 106,76,147

    // e7ecef // 231,236,239
    // 274c77 // 39,76,119
    // 6096ba // 96,150,186
    // a3cef1 // 163,206,241
    // 8b8c89 // 139,140,137

    // f94144 // 249,65,68
    // f3722c // 243,114,44
    // f8961e // 248,150,30
    // f9844a // 249,132,74
    // f9c74f // 249,199,79
    // 90be6d // 144,190,109
    // 43aa8b // 67,170,139
    // 4d908e // 77,144,142
    // 577590 // 87,117,144
    // 277da1 // 39,125,161

    // 7400b8 // 116,0,184
    // 6930c3 // 105,48,195
    // 5e60ce // 94,96,206
    // 5390d9 // 83,144,217
    // 4ea8de // 78,168,222
    // 48bfe3 // 72,191,227
    // 56cfe1 // 86,207,225
    // 64dfdf // 100,223,223
    // 72efdd // 114,239,221
    // 80ffdb // 128,255,219

    // 22223b // 34,34,59
    // 4a4e69 // 74,78,105
    // 9a8c98 // 154,140,152
    // c9ada7 // 201,173,167
    // f2e9e4 // 242,233,228

    // 5f0f40 // 95,15,64
    // 9a031e // 154,3,30
    // fb8b24 // 251,139,36
    // e36414 // 227,100,20
    // 0f4c5c // 15,76,92
    const colorList = [
      'rgb(88,47,14)',
      'rgb(127,79,36)',
      'rgb(147,102,57)',
      'rgb(166,138,100)',
      'rgb(182,173,144)',
      'rgb(194,197,170)',
      'rgb(164,172,134)',
      'rgb(101,109,74)',
      'rgb(65,72,51)',
      'rgb(51,61,29)',
      'rgb(0,8,20)', // 10
      'rgb(0,29,61)',
      'rgb(0,53,102)',
      'rgb(255,195,0)',
      'rgb(255,214,10)',
      'rgb(255,153,200)', // 15
      'rgb(252,246,189)',
      'rgb(208,244,222)',
      'rgb(169,222,249)',
      'rgb(228,193,249)',
      'rgb(0,21,36)', // 20
      'rgb(21,97,109)',
      'rgb(255,236,209)',
      'rgb(255,125,0)',
      'rgb(120,41,15)',
      'rgb(43,45,66)', // 25
      'rgb(141,153,174)',
      'rgb(237,242,244)',
      'rgb(239,35,60)',
      'rgb(217,4,41)',
      'rgb(255,89,94)', // 30
      'rgb(255,202,58)',
      'rgb(138,201,38)',
      'rgb(25,130,196)',
      'rgb(106,76,147)',
      'rgb(231,236,239)', // 35
      'rgb(39,76,119)',
      'rgb(96,150,186)',
      'rgb(163,206,241)',
      'rgb(139,140,137)',
      'rgb(249,65,68)', // 40
      'rgb(243,114,44)',
      'rgb(248,150,30)',
      'rgb(249,132,74)',
      'rgb(249,199,79)',
      'rgb(144,190,109)',
      'rgb(67,170,139)',
      'rgb(77,144,142)',
      'rgb(87,117,144)',
      'rgb(39,125,161)',
      'rgb(116,0,184)', // 50
      'rgb(105,48,195)',
      'rgb(94,96,206)',
      'rgb(83,144,217)',
      'rgb(78,168,222)',
      'rgb(86,207,225)',
      'rgb(100,223,223)',
      'rgb(114,239,221)',
      'rgb(128,255,219)',
      'rgb(34,34,59)', // 59
      'rgb(74,78,105)',
      'rgb(154,140,152)',
      'rgb(201,173,167)',
      'rgb(242,233,228)',
      'rgb(95,15,64)', // 64
      'rgb(154,3,30)',
      'rgb(251,139,36)',
      'rgb(227,100,20)',
      'rgb(15,76,92)'
    ]
    let colorStart = 0

    function init() {
      const canvas = document.getElementById('id-canvas')
      const ctx = canvas.getContext('2d')
      console.log('window inner w : ' + window.innerWidth + ', h : ' + window.innerHeight)
      console.log('window outer w : ' + window.outerWidth + ', h : ' + window.outerHeight)
      console.log('canvas w : ' + canvas.width + ', h : ' + canvas.height)

      const displaySize = document.getElementById('id-display-size')
      console.log('displaySize h : ' + displaySize.offsetHeight)

      let canvasW = window.innerWidth - 8 * 2
      let canvasH = window.innerHeight - 8 * 2 - displaySize.offsetHeight
      canvas.width = canvasW
      canvas.height = canvasH

      displaySize.innerText = `canvas w : ${canvasW}, h : ${canvasH}`

      // f:5, l-r:5, bk:5, bd:5
      // unit num : 5 x 5 x 5 x 5 = 625


      const simpleInfoList = []
      for (let i=0; i<5; i++) { // f
        for (let j=0; j<5; j++) { // l-r
          for (let k=0; k<5; k++) { // bk
            for (let l=0; l<5; l++) { // bd
              const fInfo = parsingStringToInfo(rbxRawStringSampleUt00.raw[rbxRawStringSampleUt00.f[i]])
              const lInfo = parsingStringToInfo(rbxRawStringSampleUt00.raw[rbxRawStringSampleUt00.lr[j][0]])
              const rInfo = parsingStringToInfo(rbxRawStringSampleUt00.raw[rbxRawStringSampleUt00.lr[j][1]])
              const bkInfo = parsingStringToInfo(rbxRawStringSampleUt00.raw[rbxRawStringSampleUt00.bk[k]])
              const bdInfo = parsingStringToInfo(rbxRawStringSampleUt00.raw[rbxRawStringSampleUt00.bd[l]])
              const cInfo = compositeUt00(fInfo, lInfo, rInfo, bkInfo, bdInfo)
              cInfo.fIndex = i
              cInfo.lrIndex = j
              cInfo.bkIndex = k
              cInfo.bdIndex = l
              simpleInfoList.push(cInfo)
            }
          }
        }
      }

      const startColor = 200
      const size = 2
      let div = 8
      let startMarginX = 40
      let startMarginY = 40
      let marginX = 160
      let marginY = 250
      let count = 0

      const lastX = div * marginX + startMarginX
      let lastY = Math.floor((simpleInfoList.length-1) / div)
      let lastSy = lastY * marginY + startMarginY
      console.log(`lastY : ${lastY}, lastSy : ${lastSy}, canvasH : ${canvasH}`)

      if (lastX > canvasW) {
        console.log("------------ canvas resize width")
        canvasW = lastX
        canvas.width = canvasW
        displaySize.innerText = `canvas w : ${canvasW}, h : ${canvasH}`
      }

      if ((lastSy + 200) > canvasH) {
        console.log("------------ canvas resize")
        canvasH = lastSy + 200
        canvas.height = canvasH
        displaySize.innerText = `canvas w : ${canvasW}, h : ${canvasH}`
      }

      displaySize.innerText = displaySize.innerText + `lastY : ${lastY}, lastSy : ${lastSy}, canvasH : ${canvasH}`

      for (const key in simpleInfoList) {
        const inf = simpleInfoList[key]
        const x = count % div
        const y = Math.floor(count / div)
        const sx = x * marginX + startMarginX
        const sy = y * marginY + startMarginY
        // drawRawSimple(inf, ctx, size, startColor, sx, sy)

        const sc = Math.floor(count / div * 1.7)
        drawRawSimple(inf, ctx, size, sc, sx, sy)

        console.log(`sy : ${sy}`)

        // `fi:${inf.fIndex}, lri:${inf.lrIndex}, bki:${inf.bkIndex}, bdi:${inf.bdIndex}`
        //const text = `fi:${inf.fIndex}, lri:${inf.lrIndex}, bki:${inf.bkIndex}, bdi:${inf.bdIndex}`
        const text = `${inf.fIndex}, ${inf.lrIndex}, ${inf.bkIndex}, ${inf.bdIndex}`
        const my = sy + 180
        drawText(text, ctx, size*3, sx, my)

        count++
      }
    }

    function drawRawSimple(info, ctx, size, startColor, startX, startY) {
      const list = info.raw
      const row = info.row
      // const rate = startColor / info.raw_num

      for (let i=0; i<list.length; i++) {
        const b = list[i] - 1

        if (b < 0) continue

        // const colorVal = startColor - b * rate
        // const color = `rgb(${colorVal},${colorVal},${colorVal})`
        colorStart = startColor

        const inx = b % 5
        let colorIndex = colorStart + inx
        if (colorIndex >= colorList.length) colorIndex = colorIndex % colorList.length
        const color = colorList[colorIndex]

        const x = i % row
        const y = Math.floor(i / row)
        // console.log(`i : ${i}, x : ${x}, y : ${y}`)
        drawRawInfo({
          x: x, y: y, startX: startX, startY: startY, size: size, color: color
        }, ctx)
      }
    }

    function drawRawInfo(info, ctx) {
      // console.log('color : ' + color)
      const size = info.size
      const startX = size * info.x + info.startX
      const startY = size * info.y + info.startY
      ctx.fillStyle = info.color
      ctx.beginPath()
      ctx.rect(startX, startY, size, size)
      ctx.fill()
    }

    function drawText(text, ctx, size, x, y) {
      ctx.font = `${size}px Arial`
      ctx.fillText(text, x, y)
    }

    function parsingStringToInfo(str) {
      const list = str.split('/')
      console.log(list)
      const memo = list[0]
      const row = Number(list[1])
      const column = Number(list[2])
      const rawNum = Number(list[3])
      const rawStrList = list[4].split(',')
      console.log(`memo : ${memo}, row : ${row}, column : ${column}, raw_num : ${rawNum}`)
      const raw = []

      for (const key in rawStrList) {
        const r = Number(rawStrList[key])
        raw.push(r)
      }

      const info = {
        memo: memo,
        row: row,
        column: column,
        raw_num: rawNum,
        raw: raw
      }

      return info
    }

    function compositeUt00(fInfo, lInfo, rInfo, bkInfo, bdInfo) {
      // 27 x 30
      const cRow = 27
      const cColumn = 30
      const length = cRow * cColumn
      const cRaw = []
      // const cRawNum = fInfo.raw_num
      const cRawNum = Math.max(fInfo.raw_num, lInfo.raw_num, rInfo.raw_num, bkInfo.raw_num, bdInfo.raw_num)

      for (let i=0; i<length; i++) {
        cRaw.push(0)
      }

      // f (9,0)
      // l (0,12)
      // r (18,12)
      // bk (9,21)
      // bd (6,9)

      // for (let i=0; i<fInfo.raw.length; i++) {
      //   const r = fInfo.raw[i]
      //   const x = i % fInfo.row
      //   const y = Math.floor(i / fInfo.row)
      //   const index = (x + 9) + y * cRow
      //   if (r>0) cRaw[index] = r
      // }
      posOnComposite(fInfo, cRow, cRaw, 9, 0)

      // for (let i=0; i<lInfo.raw.length; i++) {
      //   const r = lInfo.raw[i]
      //   const x = i % lInfo.row
      //   const y = Math.floor(i / lInfo.row)
      //   const index = x + (y + 12) * cRow
      //   if (r>0) cRaw[index] = r
      // }
      posOnComposite(lInfo, cRow, cRaw, 0, 12)

      // for (let i=0; i<rInfo.raw.length; i++) {
      //   const r = rInfo.raw[i]
      //   const x = i % rInfo.row
      //   const y = Math.floor(i / rInfo.row)
      //   const index = (x + 18) + (y + 12) * cRow
      //   if (r>0) cRaw[index] = r
      // }
      posOnComposite(rInfo, cRow, cRaw, 18, 12)

      // for (let i=0; i<bkInfo.raw.length; i++) {
      //   const r = bkInfo.raw[i]
      //   const x = i % bkInfo.row
      //   const y = Math.floor(i / bkInfo.row)
      //   const index = (x + 9) + (y + 21) * cRow
      //   if (r>0) cRaw[index] = r
      // }
      posOnComposite(bkInfo, cRow, cRaw, 9, 21)

      // for (let i=0; i<bdInfo.raw.length; i++) {
      //   const r = bdInfo.raw[i]
      //   const x = i % bdInfo.row
      //   const y = Math.floor(i / bdInfo.row)
      //   const index = (x + 6) + (y + 9) * cRow
      //   if (r>0) cRaw[index] = r
      // }
      posOnComposite(bdInfo, cRow, cRaw, 6, 9)

      const current = new Date()
      const y = current.getFullYear()
      const m = current.getMonth() + 1
      const d = current.getDate()
      const h = current.getHours()
      const mm = current.getMinutes()
      const s = current.getSeconds()
      console.log(`y : ${y}, m : ${m}, d : ${d}, h : ${h}, mm : ${mm}, s : ${s}`)
      const mstr = (m < 10)? `0${m}`:`${m}`
      const memo = `${y}${mstr}${d}${h}${mm}${s}_composite`

      const cInfo = {
        memo: memo,
        row: cRow,
        column: cColumn,
        raw_num: cRawNum,
        raw: cRaw
      }

      return cInfo
    }

    function posOnComposite(info, cRow, cRaw, mx, my) {
      for (let i=0; i<info.raw.length; i++) {
        const r = info.raw[i]
        const x = i % info.row
        const y = Math.floor(i / info.row)
        const index = (x + mx) + (y + my) * cRow
        if (r>0) cRaw[index] = r
      }
    }
  </script>
</body>
</html>