<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test sample layer</title>

  <style>
    body {
      -webkit-user-drag: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      position: fixed;
      overflow: hidden;
    }

    canvas {
      /*width: 100%;*/
      /*height: 100%;*/
      border: 1px solid #000000;
      background-color: beige;
    }
  </style>
</head>
<body onload="init()">
  <div>
    <label id="id-size-label">size : 20, startColor : 200</label>
  </div>

  <canvas id="id-canvas"></canvas>

  <script>
    const sample = [
      "20240119153113_f/9/12/7/0,0,0,1,1,1,0,0,0,0,0,0,1,2,1,0,0,0,0,0,1,1,2,1,1,0,0,4,0,1,2,2,2,1,0,4,4,1,1,2,3,2,1,1,4,4,4,4,2,3,2,4,4,4,4,0,4,4,4,4,4,0,4,0,0,1,4,5,4,1,0,0,0,0,1,2,5,2,1,0,0,0,0,3,5,6,5,3,0,0,0,0,3,6,6,6,3,0,0,0,0,6,6,6,6,6,0,0",
      "20240119152833_f/9/12/7/0,0,1,1,1,1,1,0,0,0,0,1,2,2,2,1,0,0,0,0,1,2,2,2,1,0,0,0,0,1,2,2,2,1,0,0,0,0,1,3,2,3,1,0,0,0,0,1,3,3,3,1,0,0,0,1,4,3,3,3,4,1,0,0,2,4,4,4,4,4,2,0,1,3,4,4,5,4,4,3,1,1,3,4,5,5,5,4,3,1,1,2,5,5,6,5,5,2,1,1,2,5,6,6,6,5,2,1",
      "20240119152518_f/9/12/7/0,2,2,5,5,5,2,2,0,0,2,1,1,5,1,1,2,0,2,2,1,2,5,2,1,2,2,1,2,2,5,5,5,2,2,1,1,1,4,2,5,2,4,1,1,0,0,4,2,6,2,4,0,0,0,0,4,6,6,6,4,0,0,0,0,4,4,6,4,4,0,0,0,0,1,3,6,3,1,0,0,1,6,6,6,6,6,6,6,1,1,1,6,4,4,4,6,1,1,1,3,3,3,4,3,3,3,1",
      "20240119152131_f/9/12/7/0,0,0,1,1,1,0,0,0,0,0,2,5,4,5,2,0,0,0,0,5,5,4,5,5,0,0,0,0,5,4,4,4,5,0,0,0,0,5,4,4,4,5,0,0,0,3,5,4,5,4,5,3,0,0,3,5,5,5,5,5,3,0,0,3,3,5,6,5,3,3,0,0,3,6,6,6,6,6,3,0,0,2,2,6,6,6,2,2,0,0,2,2,1,6,1,2,2,0,0,2,2,2,1,2,2,2,0",
      "20240119151651_f/9/12/5/0,0,0,1,1,1,0,0,0,0,0,0,1,4,1,0,0,0,0,0,0,3,4,3,0,0,0,0,0,2,3,4,3,2,0,0,0,0,2,4,4,4,2,0,0,0,2,2,4,4,4,2,2,0,0,2,2,4,4,4,2,2,0,3,2,2,4,4,4,2,2,3,3,2,3,3,4,3,3,2,3,3,3,3,1,4,1,3,3,3,3,3,3,1,4,1,3,3,3,3,3,2,1,1,1,2,3,3",
      "20240119155318_l/9/12/7/0,0,0,0,0,0,1,4,4,0,0,0,0,1,1,1,4,6,0,0,0,0,1,3,3,4,6,0,0,0,1,1,6,6,6,6,1,1,1,1,3,3,6,6,6,2,3,3,3,3,4,5,5,6,2,2,2,3,3,3,5,5,5,2,2,2,2,2,2,3,4,5,0,0,0,2,2,2,2,3,4,0,0,0,0,0,2,2,3,4,0,0,0,0,0,0,2,2,4,0,0,0,0,0,0,2,2,4",
      "20240119155121_l/9/12/7/0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,3,3,3,2,2,2,3,3,3,3,3,6,1,3,3,3,3,3,4,6,6,1,1,3,3,4,4,6,6,6,1,1,1,3,5,5,6,6,6,0,1,1,1,3,4,5,6,6,0,0,1,1,3,4,4,5,6,0,0,0,1,3,1,4,5,6,0,0,0,1,1,1,5,5,6,0,0,0,0,1,1,5,5,6,0,0,0,0,0,1,5,5,5",
      "20240119154558_l/9/12/7/0,0,0,0,2,2,4,4,5,0,0,0,2,2,2,4,4,5,0,0,1,2,4,4,4,5,5,0,1,1,2,4,4,5,5,5,1,1,3,2,4,5,5,6,6,1,1,3,2,4,5,6,6,6,1,3,3,3,5,5,6,6,6,1,1,3,3,5,5,6,5,6,0,1,1,1,3,2,6,5,6,0,0,0,1,1,2,4,4,5,0,0,0,0,1,1,2,4,5,0,0,0,0,0,1,3,3,5",
      "20240119154214_l/9/12/7/0,0,0,0,0,1,1,5,1,0,0,0,2,2,1,5,5,1,0,0,4,3,2,2,5,5,6,0,4,4,3,2,5,5,6,6,4,4,3,3,5,5,6,6,6,4,3,3,2,2,5,6,6,6,4,4,3,2,2,5,5,6,6,4,4,3,3,2,2,5,6,6,4,4,3,3,2,2,5,5,6,4,4,4,3,3,2,5,5,6,0,0,4,4,2,2,1,5,6,0,0,0,2,2,1,1,5,1",
      "2024011915498_l/9/12/7/0,0,0,0,0,0,1,5,5,0,0,0,0,0,1,1,5,5,0,0,0,0,0,1,4,5,5,0,0,0,0,1,1,4,5,6,0,0,0,0,1,1,4,5,6,0,0,0,1,1,2,5,5,6,0,0,1,1,2,2,5,5,6,0,1,1,2,2,3,5,5,6,0,1,2,2,3,3,5,6,6,1,1,2,2,3,6,5,6,6,1,2,2,3,6,6,6,6,6,1,2,2,3,6,6,6,6,6",
      "20240119155318_l_h_reverse/9/12/7/4,4,1,0,0,0,0,0,0,6,4,1,1,1,0,0,0,0,6,4,3,3,1,0,0,0,0,6,6,6,6,1,1,0,0,0,6,6,6,3,3,1,1,1,1,6,5,5,4,3,3,3,3,2,5,5,5,3,3,3,2,2,2,5,4,3,2,2,2,2,2,2,4,3,2,2,2,2,0,0,0,4,3,2,2,0,0,0,0,0,4,2,2,0,0,0,0,0,0,4,2,2,0,0,0,0,0,0",
      "20240119155121_l_h_reverse/9/12/7/2,2,2,2,2,0,0,0,0,3,3,3,2,2,2,2,2,2,6,3,3,3,3,3,2,2,2,6,6,4,3,3,3,3,3,1,6,6,6,4,4,3,3,1,1,6,6,6,5,5,3,1,1,1,6,6,5,4,3,1,1,1,0,6,5,4,4,3,1,1,0,0,6,5,4,1,3,1,0,0,0,6,5,5,1,1,1,0,0,0,6,5,5,1,1,0,0,0,0,5,5,5,1,0,0,0,0,0",
      "20240119154558_l_h_reverse/9/12/7/5,4,4,2,2,0,0,0,0,5,4,4,2,2,2,0,0,0,5,5,4,4,4,2,1,0,0,5,5,5,4,4,2,1,1,0,6,6,5,5,4,2,3,1,1,6,6,6,5,4,2,3,1,1,6,6,6,5,5,3,3,3,1,6,5,6,5,5,3,3,1,1,6,5,6,2,3,1,1,1,0,5,4,4,2,1,1,0,0,0,5,4,2,1,1,0,0,0,0,5,3,3,1,0,0,0,0,0",
      "20240119154214_l_h_reverse/9/12/7/1,5,1,1,0,0,0,0,0,1,5,5,1,2,2,0,0,0,6,5,5,2,2,3,4,0,0,6,6,5,5,2,3,4,4,0,6,6,6,5,5,3,3,4,4,6,6,6,5,2,2,3,3,4,6,6,5,5,2,2,3,4,4,6,6,5,2,2,3,3,4,4,6,5,5,2,2,3,3,4,4,6,5,5,2,3,3,4,4,4,6,5,1,2,2,4,4,0,0,1,5,1,1,2,2,0,0,0",
      "2024011915498_l_h_reverse/9/12/7/5,5,1,0,0,0,0,0,0,5,5,1,1,0,0,0,0,0,5,5,4,1,0,0,0,0,0,6,5,4,1,1,0,0,0,0,6,5,4,1,1,0,0,0,0,6,5,5,2,1,1,0,0,0,6,5,5,2,2,1,1,0,0,6,5,5,3,2,2,1,1,0,6,6,5,3,3,2,2,1,0,6,6,5,6,3,2,2,1,1,6,6,6,6,6,3,2,2,1,6,6,6,6,6,3,2,2,1",
      "20240119162153_bk/9/9/7/1,1,3,6,3,6,3,1,1,1,3,3,6,6,6,3,3,1,1,3,3,6,6,6,3,3,1,1,3,3,3,6,3,3,3,1,2,2,3,4,6,4,3,2,2,2,2,2,4,6,4,2,2,2,2,4,4,4,5,4,4,4,2,2,4,4,5,5,5,4,4,2,2,2,4,4,5,4,4,2,2",
      "20240119162015_bk/9/9/7/0,0,0,5,6,5,0,0,0,0,0,1,4,5,4,1,0,0,0,1,1,4,4,4,1,1,0,1,2,2,4,3,4,2,2,1,2,2,2,4,3,4,2,2,2,1,2,3,3,3,3,3,2,1,0,1,2,3,3,3,2,1,0,0,0,1,2,3,2,1,0,0,0,0,0,1,2,1,0,0,0",
      "20240119161616_bk/9/9/7/0,0,1,3,3,3,1,0,0,0,0,1,3,3,3,1,0,0,0,1,1,3,4,3,1,1,0,1,1,2,5,4,5,2,1,1,1,2,2,5,5,5,2,2,1,2,2,2,5,6,5,2,2,2,0,2,2,5,5,5,2,2,0,0,0,0,5,4,5,0,0,0,0,0,0,4,4,4,0,0,0",
      "20240119161425_bk/9/9/7/4,4,4,6,6,6,4,4,4,4,1,3,6,6,6,3,1,4,4,1,2,6,5,6,2,1,4,0,1,2,6,5,6,2,1,0,0,1,2,2,5,2,2,1,0,0,0,1,2,5,2,1,0,0,0,0,0,1,2,1,0,0,0,0,0,0,1,2,1,0,0,0,0,0,0,0,1,0,0,0,0",
      "2024011916187_bk/9/9/7/0,0,1,1,1,1,1,0,0,0,1,1,1,3,1,1,1,0,0,1,3,3,6,3,3,1,0,0,1,3,3,6,3,3,1,0,0,0,2,3,3,3,2,0,0,0,0,2,2,3,2,2,0,0,0,1,1,2,4,2,1,1,0,1,1,2,4,4,4,2,1,1,1,1,2,4,5,4,2,1,1",
      "20240119161037_bd/15/15/7/1,1,1,3,3,1,1,1,1,1,3,3,1,1,1,1,3,3,3,3,1,1,4,1,1,3,3,3,3,1,1,1,3,3,3,1,4,4,4,1,3,3,3,1,1,0,1,1,3,3,3,4,4,4,3,3,3,1,1,0,0,0,1,2,3,2,4,4,4,2,3,2,1,0,0,0,0,1,2,2,2,4,4,4,2,2,2,1,0,0,0,0,1,2,2,6,4,4,4,6,2,2,1,0,0,0,0,0,2,2,6,4,4,4,6,2,2,0,0,0,0,0,0,2,2,6,5,4,5,6,2,2,0,0,0,0,0,0,2,2,6,5,4,5,6,2,2,0,0,0,0,0,0,2,2,6,5,5,5,6,2,2,0,0,0,0,0,0,2,2,6,6,5,6,6,2,2,0,0,0,0,0,0,2,2,6,6,6,6,6,2,2,0,0,0,0,0,0,2,6,6,4,5,4,6,6,2,0,0,0,0,0,0,2,6,4,4,5,4,4,6,2,0,0,0",
      "20240119155525_bd/15/15/7/0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,1,2,1,3,3,3,1,2,1,1,0,0,0,1,1,2,2,2,3,3,3,2,2,2,1,1,0,1,1,2,2,2,2,3,3,3,2,2,2,2,1,1,1,1,2,2,2,4,3,3,3,4,2,2,2,1,1,1,1,2,2,4,4,3,3,3,4,4,2,2,1,1,1,1,2,2,4,4,5,3,5,4,4,2,2,1,1,1,1,2,4,4,4,5,5,5,4,4,4,2,1,1,1,1,2,4,4,5,5,6,5,5,4,4,2,1,1,1,1,2,2,4,5,6,6,6,5,4,2,2,1,1,1,1,2,2,2,5,6,6,6,5,2,2,2,1,1,1,1,2,2,2,5,6,6,6,5,2,2,2,1,1,1,1,2,2,2,5,6,6,6,5,2,2,2,1,1,0,1,1,2,2,5,6,3,6,5,2,2,1,1,0,0,0,1,1,2,5,6,3,6,5,2,1,1,0,0",
      "2024011916611_bd/15/15/7/0,0,0,2,3,3,3,4,3,3,3,2,0,0,0,0,0,0,2,2,2,3,4,3,2,2,2,0,0,0,0,0,0,1,1,2,5,4,5,2,1,1,0,0,0,0,1,1,1,1,2,5,4,5,2,1,1,1,1,0,0,1,2,2,2,2,5,4,5,2,2,2,2,1,0,1,1,2,3,3,3,5,5,5,3,3,3,2,1,1,2,2,2,3,3,3,4,5,4,3,3,3,2,2,2,2,2,2,2,2,3,5,5,5,3,2,2,2,2,2,2,1,1,1,2,2,5,6,5,2,2,1,1,1,2,1,1,1,1,2,2,5,6,5,2,2,1,1,1,1,0,1,1,1,2,6,6,6,6,6,2,1,1,1,0,0,1,1,1,2,3,6,6,6,3,2,1,1,1,0,0,0,0,1,2,3,3,6,3,3,2,1,0,0,0,0,0,0,1,2,2,3,6,3,2,2,1,0,0,0,0,0,0,1,2,2,2,3,2,2,2,1,0,0,0",
      "2024011916320_bd/15/15/7/0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,4,1,1,1,4,1,1,1,0,0,0,1,1,3,1,4,4,1,4,4,1,3,1,1,0,0,1,1,3,3,3,4,4,4,3,3,3,1,1,0,0,1,1,3,3,3,4,4,4,3,3,3,1,1,0,0,1,2,3,3,3,5,4,5,3,3,3,2,1,0,0,1,2,3,5,5,6,5,6,5,5,3,2,1,0,0,1,2,3,5,6,6,6,6,6,5,3,2,1,0,0,1,2,3,3,3,4,6,4,3,3,3,2,1,0,0,1,2,3,3,2,4,6,4,2,3,3,2,1,0,0,1,2,3,3,2,4,6,4,2,3,3,2,1,0,0,1,1,3,3,1,4,4,4,1,3,3,1,1,0,0,1,1,3,1,1,1,4,1,1,1,3,1,1,0,0,0,1,1,1,1,1,4,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0",
      "2024011915595_bd/15/15/7/0,0,0,1,2,2,2,4,2,2,2,1,0,0,0,0,0,1,2,2,3,3,4,3,3,2,2,1,0,0,0,1,2,2,3,3,3,4,3,3,3,2,2,1,0,1,2,2,3,3,3,4,4,4,3,3,3,2,2,1,1,2,3,3,3,4,4,5,4,4,3,3,3,2,1,1,2,3,3,3,4,4,5,4,4,3,3,3,2,1,2,2,3,3,3,4,4,5,4,4,3,3,3,2,2,2,3,3,3,3,6,4,5,4,6,3,3,3,3,2,2,3,3,3,6,6,4,6,4,6,6,3,3,3,2,2,3,3,6,6,6,6,6,6,6,6,6,3,3,2,2,2,3,3,3,6,6,5,6,6,3,3,3,2,2,1,2,2,2,3,2,4,5,4,2,3,2,2,2,1,1,1,2,2,2,4,4,5,4,4,2,2,2,1,1,1,1,1,2,2,4,4,5,4,4,2,2,1,1,1,1,1,1,2,2,4,4,5,4,4,2,2,1,1,1",
      "20240122143329-mis-00-00/1/5/5/4,3,2,1,1",
      "20240122143329-mis-00-01/2/5/5/4,4,3,3,2,2,1,1,1,1",
      "20240122143329-mis-00-02/3/5/5/4,4,4,3,3,3,2,2,2,1,1,1,1,1,1",
      "20240122143329-mis-00-03/4/5/5/4,4,4,4,3,3,3,3,2,2,2,2,1,1,1,1,1,1,1,1",
      "20240122143329-mis-00-04/5/5/5/4,4,4,4,4,3,3,3,3,3,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1"
    ]

    const START_X = 30
    const START_Y = 30
    const GUIDE_COLOR = 'slateblue'

    let canvas
    let ctx
    let canvasW = 100
    let canvasH = 100
    let memo = ''
    let row = 9
    let column = 12
    let rawNum = 7
    let size = 6
    let startColor = 200
    let colorInterval = 40
    let raw = []
    let isGuide = false

    function init() {
      canvas = document.getElementById('id-canvas')
      ctx = canvas.getContext('2d')
      console.log('window inner w : ' + window.innerWidth + ', h : ' + window.innerHeight)
      console.log('window outer w : ' + window.outerWidth + ', h : ' + window.outerHeight)
      console.log('canvas w : ' + canvas.width + ', h : ' + canvas.height)

      canvasW = window.innerWidth - 8 * 2
      canvasH = window.innerHeight - 8 * 2 - 150
      canvas.width = canvasW
      canvas.height = canvasH

      const sizeLabel = document.getElementById('id-size-label')
      sizeLabel.innerText = `${canvasW} x ${canvasH}`

      const info = parsingStringToInfo(sample[24])
      memo = info.memo
      row = info.row
      column = info.column
      rawNum = info.raw_num
      raw = info.raw

      console.log(`rawNum : ${rawNum}`)

      const layerList = divideLayer(raw, rawNum, row, column)
      console.log(layerList)

      initColorInterval()

      // isGuide = true
      draw()

      for (let i=0; i<layerList.length; i++) {
        console.log(i)
        const layer = layerList[i]
        const x = (size * row + 2) * (i + 1) + START_X
        drawRaw(layer, row, size, x, START_Y, startColor, colorInterval)

        // draw guide
        if (!isGuide)continue
        drawGuide(layer, row, size, x, START_Y)
      }
    }

    function divideLayer(raw, rawNum, row, column) {
      const length = row * column
      const result = []
      for (let i=0; i<rawNum; i++) {
        const list = []
        for (let j=0; j<length; j++) {
          list.push(0)
        }
        result.push(list)
      }

      for (let i=0; i<raw.length; i++) {
        const r = raw[i]
        for (let j=0; j<=r; j++) {
          result[j][i] = j
        }
      }

      return result
    }

    function initColorInterval() {
      colorInterval = startColor / rawNum
    }

    function draw() {
      ctx.clearRect(0, 0, canvasW, canvasH)
      drawRaw(raw, row, size, START_X, START_Y, startColor, colorInterval)

      // draw guide
      if (!isGuide)return
      drawGuide(raw, row, size, START_X, START_Y)
    }

    function drawRaw(raw, row, size, startX, startY, startColor, colorInterval) {
      for (let i=0; i<raw.length; i++) {
        const r = raw[i]
        const colorVal = startColor - r * colorInterval
        const color = `rgb(${colorVal},${colorVal},${colorVal})`
        const x = i % row
        const y = Math.floor(i / row)
        const sx = size * x + startX
        const sy = size * y + startY
        ctx.fillStyle = color
        ctx.beginPath()
        ctx.rect(sx, sy, size, size)
        ctx.fill()
      }
    }

    function drawGuide(raw, row, size, startX, startY) {
      for (let i=0; i<raw.length; i++) {
        const x = i % row
        const y = Math.floor(i / row)
        const sx = size * x + startX
        const sy = size * y + startY
        ctx.strokeStyle = GUIDE_COLOR
        ctx.lineWidth = 0.3
        ctx.beginPath()
        ctx.rect(sx, sy, size, size)
        ctx.stroke()
      }
    }

    function parsingStringToInfo(str) {
      const list = str.split('/')
      console.log(list)
      const memo = list[0]
      const row = Number(list[1])
      const column = Number(list[2])
      const rawNum = Number(list[3])
      const rawStrList = list[4].split(',')
      console.log(`memo : ${memo}, row : ${row}, column : ${column}, raw_num : ${rawNum}`)
      const raw = []

      for (const key in rawStrList) {
        const r = Number(rawStrList[key])
        raw.push(r)
      }

      const info = {
        memo: memo,
        row: row,
        column: column,
        raw_num: rawNum,
        raw: raw
      }

      return info
    }

    function parsingInfoToString(info) {
      let result = ""
      result += `${info.memo}/${info.row}/${info.column}/${info.raw_num}/`

      for (let i=0; i<info.raw.length; i++) {
        if (i === info.raw.length-1) {
          result += `${info.raw[i]}`
        } else {
          result += `${info.raw[i]},`
        }
      }

      return result
    }

    function save(rawString) {
      console.log(`save ::: ${rawString}`)
      const name = rawString.split('/')[0]
      const link = document.createElement("a")
      const file = new Blob([rawString], {type:'text/plain'})
      link.href = URL.createObjectURL(file)
      link.download = `${name}.txt`
      link.click()
      URL.revokeObjectURL(link.href)
    }
  </script>
</body>
</html>